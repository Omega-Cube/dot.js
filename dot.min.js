var DotUtils=function(){};DotUtils.escapeContainer=null;DotUtils.escapeText=null;DotUtils.escapeHtml=function(){DotUtils.escapeContainer=document.createElement("div");DotUtils.escapeText=document.createTextNode("");DotUtils.escapeContainer.appendChild(DotUtils.escapeText);return realEscape=function(a){DotUtils.escapeText.data=a;return DotUtils.escapeContainer.innerHTML}}();DotUtils.setHtml=function(a,b){b=b.replace(/<script[^>]*>([\\S\\s]*?)<\/script>/img,"");a.innerHTML=b};
DotUtils.bind=function(a,b){return function(){return b.apply(a,Array.prototype.slice.call(arguments))}};
DotUtils.ajaxGet=function(a,b,c){var d=null;if(window.XMLHttpRequest)d=new window.XMLHttpRequest;else try{d=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){d=null}d===null&&alert("Your browser does not support basic AJAX requests");if(typeof b!=="undefined"&&b!==null){var g=false;a.indexOf("?")>-1&&(idFirst=false);for(p in b)g?(a+="?",g=false):a+="&",a+=escape(p)+"="+escape(b[p])}d.open("GET",a,true);d.onreadystatechange=function(){d.readyState==4&&(d.status==200?c(d.responseText):d.status==0&&(alert("It seems you have some cross-domain access issues. Dot.js does not support cross-domain loading (yet ?). I'll still try to load your data but the app might get unstable."),
c(d.responseText)))};d.send()};DotUtils.extend=function(a,b){for(var c in b)a[c]=b[c];return a};DotUtils.addEventHandler=function(a,b,c){a.addEventListener?(b=="mousewheel"&&(b="DOMMouseScroll"),a.addEventListener(b,c,false)):a.attachEvent&&a.attachEvent("on"+b,c)};DotUtils.removeEventHandler=function(a,b,c){a.removeEventHandler?(b=="mousewheel"&&(b="DOMMouseScroll"),a.removeEventHandler(b,c,false)):a.detachEvent&&a.detachEvent("on"+b,c)};
DotUtils.preventDefault=function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();a.cancelBubble=true;a.cancel=true;a.returnValue=true;return false};
DotUtils.createClass=function(){function a(){this.initialize.apply(this,arguments)}var b=null,c=Array.prototype.slice.call(arguments);typeof c[0]==="function"&&(b=c.shift());if(a.superclass=b){var d=function(){};d.prototype=b.prototype;a.prototype=new d}for(b=0;b<c.length;b++)DotUtils.addMethods(a,c[b]);if(!a.prototype.initialize)a.prototype.initialize=DotUtils.emptyFunction;return a.prototype.constructor=a};DotUtils.emptyFunction=function(){};
DotUtils.addMethods=function(a,b){var c=a.superclass&&a.superclass.prototype,d=[],e;for(e in b)d.push(e);for(var g=0,h=d.length;g<h;g++){e=d[g];var f=b[e];if(c&&typeof f==="function"&&DotUtils.argumentNames(f)[0]=="$super")var i=f,f=function(a){return function(){return c[a].apply(this,arguments)}}(e),f=DotUtils.wrap(f,i);a.prototype[e]=f}return a};
DotUtils.argumentNames=function(a){a=a.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return a.length==1&&!a[0]?[]:a};DotUtils.wrap=function(a,b){return function(){return b.apply(this,[DotUtils.bind(this,a)].concat(Array.prototype.slice.call(arguments)))}};
var DotTokenizer=DotUtils.createClass({initialize:function(a){this.str=a},takeChars:function(a){a||(a=1);for(var b=[];a--;){var c=this.str.match(/^(\S+)\s*/);c?(this.str=this.str.substr(c[0].length),b.push(c[1])):b.push(false)}return 1==b.length?b[0]:b},takeNumber:function(a){a||(a=1);if(1==a)return Number(this.takeChars());else{for(var b=this.takeChars(a);a--;)b[a]=Number(b[a]);return b}},takeString:function(){var a=Number(this.takeChars()),b=0,c;if("-"!=this.str.charAt(0))return false;for(;0<a;)++b,
c=this.str.charCodeAt(b),128>c?--a:a-=2048>c?2:3;a=this.str.substr(1,b);this.str=this.str.substr(1+b).replace(/^\s+/,"");return a}}),DotEntity=DotUtils.createClass({initialize:function(a,b,c,d,e,g){this.defaultAttrHashName=a;this.name=b;this.dot=c;this.rootGraph=d;this.parentGraph=e;this.immediateGraph=g;this.attrs={};this.drawAttrs={}},initBB:function(){var a=this.getAttr("pos").match(/([0-9.]+),([0-9.]+)/),b=Math.round(a[1]),a=Math.round(this.dot.height-a[2]);this.bbRect=new Rect(b,a,b,a)},getAttr:function(a,
b){typeof escStrinng==="undefined"&&(b=false);var c=this.attrs[a];if(typeof c==="undefined")for(var d=this.parentGraph;typeof d!=="undefined";)if(c=d[this.defaultAttrHashName][a],typeof c==="undefined")d=d.parentGraph;else break;c&&b&&(c=c.replace(this.escStringMatchRe,function(a,b){switch(b){case "N":case "E":return this.name;case "T":return this.tailNode;case "H":return this.headNode;case "G":return this.immediateGraph.name;case "L":return this.getAttr("label",true)}return a}.bind(this)));return c},
draw:function(a,b,c){var d,e,g;if(!c){this.initBB();var h=document.createElement("div");this.dot.elements.appendChild(h)}for(daKey in this.drawAttrs){var f=new DotTokenizer(this.drawAttrs[daKey]);if(d=f.takeChars()){var i="solid";for(a.save();d;){switch(d){case "E":case "e":var l="E"==d,k=f.takeNumber();d=this.dot.height-f.takeNumber();e=f.takeNumber();var m=f.takeNumber(),k=new Ellipse(k,d,e,m);break;case "P":case "p":case "L":var l="P"==d,m="L"!=d,j=f.takeNumber();e=f.takeNumber(2*j);k=new Path;
for(d=2;d<2*j;d+=2)k.addBezier([new Point(e[d-2],this.dot.height-e[d-1]),new Point(e[d],this.dot.height-e[d+1])]);m&&k.addBezier([new Point(e[2*j-2],this.dot.height-e[2*j-1]),new Point(e[0],this.dot.height-e[1])]);break;case "B":case "b":l="b"==d;j=f.takeNumber();e=f.takeNumber(2*j);k=new Path;for(d=2;d<2*j;d+=6)k.addBezier([new Point(e[d-2],this.dot.height-e[d-1]),new Point(e[d],this.dot.height-e[d+1]),new Point(e[d+2],this.dot.height-e[d+3]),new Point(e[d+4],this.dot.height-e[d+5])]);break;case "I":d=
f.takeNumber();e=this.dot.height-f.takeNumber();var m=f.takeNumber(),j=f.takeNumber(),o=f.takeString();this.dot.images[o]||(this.dot.images[o]=new DotImage(this.dot,o));this.dot.images[o].draw(a,d,e-j,m,j);break;case "T":d=Math.round(b*f.takeNumber()+this.dot.padding);e=Math.round(b*this.dot.height+2*this.dot.padding-(b*(f.takeNumber()+this.dot.bbScale*fontSize)+this.dot.padding));m=f.takeNumber();j=Math.round(b*f.takeNumber());o=f.takeString();if(!c&&!/^\s*$/.test(o)){o=DotUtils.escapeHtml(o);do if(matches=
o.match(/ ( +)/)){var q=" ";matches[1].length.times(function(){q+="&nbsp;"});o=o.replace(/  +/,q)}while(matches);var n,r=this.getAttr("URL",true)||this.getAttr("href",true);if(r){var s=this.getAttr("target",true)||"_self",u=this.getAttr("tooltip",true)||this.getAttr("label",true);n=document.createElement("a");n.href=r;n.target=s;n.title=u;var r="onclick,onmousedown,onmouseup,onmouseover,onmousemove,onmouseout".split(","),t;for(t in r)(s=this.getAttr(t,true))&&n.setAttribute(t,s);n.style.textDecoration=
"none"}else n=document.createElement("span");DotUtils.setHtml(n,o);n.style.fontSize=Math.round(fontSize*b*this.dot.bbScale)+"px";n.style.fontFamily=fontFamily;n.style.color=g.textColor;n.style.position="absolute";n.style.textAlign=-1==m?"left":1==m?"right":"center";n.style.left=d-(1+m)*j+"px";n.style.top=e+"px";n.style.width=2*j+"px";if(1!=g.opacity)n.style.opacity=g.opacity;this.dot.elements.appendChild(n)}break;case "C":case "c":d="C"==d;e=this.parseColor(f.takeString());d?a.fillStyle=e.canvasColor:
(g=e,a.strokeStyle=e.canvasColor);break;case "F":fontSize=f.takeNumber();fontFamily=f.takeString();switch(fontFamily){case "Times-Roman":fontFamily="Times New Roman";break;case "Courier":fontFamily="Courier New";break;case "Helvetica":fontFamily="Arial"}break;case "S":d=f.takeString();switch(d){case "solid":case "filled":break;case "dashed":case "dotted":i=d;break;case "bold":a.lineWidth=2;break;default:(matches=d.match(/^setlinewidth\((.*)\)$/))?a.lineWidth=Number(matches[1]):debug("unknown style "+
d)}break;default:debug("unknown token "+d);return}k&&(this.dot.drawPath(a,k,l,i),c||this.bbRect.expandToInclude(k.getBB()),k=void 0);d=f.takeChars()}if(!c)h.style.position="absolute",h.style.left=Math.round(b*this.bbRect.l+this.dot.padding)+"px",h.style.top=Math.round(b*this.bbRect.t+this.dot.padding)+"px",h.style.width=Math.round(b*this.bbRect.getWidth())+"px",h.style.height=Math.round(b*this.bbRect.getHeight())+"px";a.restore()}}},parseColor:function(a){var b={opacity:1};if(/^#(?:[0-9a-f]{2}\s*){3,4}$/i.test(a))return this.dot.parseHexColor(a);
var c=a.match(/^(\d+(?:\.\d+)?)[\s,]+(\d+(?:\.\d+)?)[\s,]+(\d+(?:\.\d+)?)$/);if(c)return b.canvasColor=b.textColor=this.dot.hsvToRgbColor(c[1],c[2],c[3]),b;var d=this.getAttr("colorscheme")||"X11",e=a;if(c=a.match(/^\/(.*)\/(.*)$/))c[1]&&(d=c[1]),e=c[2];else if(c=a.match(/^\/(.*)$/))d="X11",e=c[1];e=e.toLowerCase();c=d.toLowerCase();if(c=Dot.prototype.colors[c]){var g=c[e];if(g)return this.dot.parseHexColor("#"+g)}if(g=Dot.prototype.colors.fallback[e])return this.dot.parseHexColor("#"+g);c||debug("unknown color scheme "+
d);debug("unknown color "+a+"; color scheme is "+d);b.canvasColor=b.textColor="#000000";return b}}),DotNode=DotUtils.createClass(DotEntity,{initialize:function($super,b,c,d,e){$super("nodeAttrs",b,c,d,e,e)}});DotUtils.extend(DotNode.prototype,{escStringMatchRe:/\\([NGL])/g});var DotEdge=DotUtils.createClass(DotEntity,{initialize:function($super,b,c,d,e,g,h){$super("edgeAttrs",b,c,d,e,e);this.tailNode=g;this.headNode=h}});DotUtils.extend(DotEdge.prototype,{escStringMatchRe:/\\([EGTHL])/g});
var DotGraph=DotUtils.createClass(DotEntity,{initialize:function($super,b,c,d,e){$super("attrs",b,c,d,e,this);this.nodeAttrs={};this.edgeAttrs={};this.nodes=[];this.edges=[];this.subgraphs=[]},initBB:function(){var a=this.getAttr("bb").split(",");this.bbRect=new Rect(a[0],this.dot.height-a[1],a[2],this.dot.height-a[3])},draw:function($super,b,c,d){$super(b,c,d);for(var e=[this.subgraphs,this.nodes,this.edges],g=0,h=e.length;g<h;++g)for(var f=e[g],i=0,l=f.length;i<l;++i)f[i].draw(b,c,d)}});
DotUtils.extend(DotGraph.prototype,{escStringMatchRe:/\\([GL])/g});
var Dot=DotUtils.createClass({maxXdotVersion:"1.2",colors:{fallback:{black:"000000",lightgrey:"d3d3d3",white:"ffffff"}},initialize:function(a,b,c){this.canvas=document.createElement("canvas");this.canvas.style.position="absolute";if(!Dot.canvasCounter)Dot.canvasCounter=0;this.canvas.id="dot_canvas_"+ ++Dot.canvasCounter;this.elements=document.createElement("div");this.elements.style.position="absolute";this.container=document.getElementById(a);this.container.style.position="relative";this.container.appendChild(this.canvas);
if(typeof G_vmlCanvasManager!=="undefined")G_vmlCanvasManager.initElement(this.canvas),this.canvas=document.getElementById(this.canvas.id);this.container.appendChild(this.elements);this.ctx=this.canvas.getContext("2d");this.scale=1;this.padding=8;this.dashLength=6;this.dotSpacing=4;this.graphs=[];this.images={};this.numImagesFinished=this.numImages=0;this.graphLoaded=false;this.allowMouseScrolling=true;b&&this.load(b,c);DotUtils.addEventHandler(this.container,"mousewheel",DotUtils.bind(this,this._handleMouseWheel))},
setScale:function(a){this.scale=+a;if(this.scale<=0)this.scale=0.001;this.graphLoaded&&this.draw()},getScale:function(){return this.scale},setAllowMouseScrolling:function(a){this.allowMouseScrolling=!!a},getAllowMouseScrolling:function(){return this.allowMouseScrolling},setImagePath:function(a){this.imagePath=a},load:function(a,b){document.getElementById("debug_output").innerHTML="";var c=DotUtils.bind(this,function(a){this.parse(a)});DotUtils.ajaxGet(a,b,c)},parse:function(a){this.graphs=[];this.height=
this.width=0;this.bbEnlarge=this.maxHeight=this.maxWidth=false;this.bbScale=1;this.dpi=96;this.bgcolor={opacity:1};this.bgcolor.canvasColor=this.bgcolor.textColor="#ffffff";for(var a=a.split(/\r?\n/),b=0,c,d,e,g,h,f,i,l,k,m,j=[];b<a.length;)if(c=a[b++].replace(/^\s+/,""),""!=c&&"#"!=c.substr(0,1)){for(;b<a.length&&";"!=(d=c.substr(c.length-1,c.length))&&"{"!=d&&"}"!=d;)"\\"==d&&(c=c.substr(0,c.length-1)),c+=a[b++];if(0==j.length){if(e=c.match(this.graphMatchRe))g=new DotGraph(e[3],this),j.unshift(g),
j[0].strict=typeof e[1]!=="undefined",j[0].type="graph"==e[2]?"undirected":"directed",j[0].attrs.xdotversion="1.0",this.graphs.push(j[0])}else if(e=c.match(this.subgraphMatchRe))j.unshift(new DotGraph(e[1],this,g,j[0])),j[1].subgraphs.push(j[0]);if(!e)if("}"==c){if(j.shift(),0==j.length)break}else{if(e=c.match(this.nodeMatchRe))switch(f=e[2],i=e[5],m=j[0].drawAttrs,h=false,f){case "graph":k=j[0].attrs;h=true;break;case "node":k=j[0].nodeAttrs;break;case "edge":k=j[0].edgeAttrs;break;default:c=new DotNode(f,
this,g,j[0]),k=c.attrs,m=c.drawAttrs,j[0].nodes.push(c)}else if(e=c.match(this.edgeMatchRe))f=e[1],i=e[8],c=new DotEdge(f,this,g,j[0],e[2],e[5]),k=c.attrs,m=c.drawAttrs,j[0].edges.push(c);if(e){do{if(0==i.length)break;if(e=i.match(this.attrMatchRe)){if(i=i.substr(e[0].length),c=e[1],l=this.unescape(e[2]),/^_.*draw_$/.test(c)?m[c]=l:k[c]=l,h&&1==j.length)switch(c){case "bb":c=l.split(/,/);this.width=Number(c[2]);this.height=Number(c[3]);break;case "bgcolor":this.bgcolor=g.parseColor(l);break;case "dpi":this.dpi=
l;break;case "size":(c=l.match(/^(\d+|\d*(?:\.\d+)),\s*(\d+|\d*(?:\.\d+))(!?)$/))?(this.maxWidth=72*Number(c[1]),this.maxHeight=72*Number(c[2]),this.bbEnlarge="!"==c[3]):debug("can't parse size");break;case "xdotversion":0>this.versionCompare(this.maxXdotVersion,k.xdotversion)&&debug("unsupported xdotversion "+k.xdotversion+"; this script currently supports up to xdotversion "+this.maxXdotVersion)}}else debug("can't read attributes for entity "+f+" from "+i)}while(e)}}}this.draw();this.graphLoaded=
true},draw:function(a){typeof a==="undefined"&&(a=false);var b=this.scale*this.dpi/72,c=Math.round(b*this.width+2*this.padding),d=Math.round(b*this.height+2*this.padding);if(!a){this.canvas.width=c;this.canvas.height=d;this.canvas.style.width=c+"px";this.canvas.style.height=d+"px";for(this.container.style.width=c+"px";this.elements.firstChild;)this.elements.removeChild(this.elements.firstChild)}this.ctx.save();this.ctx.lineCap="round";this.ctx.fillStyle=this.bgcolor.canvasColor;this.ctx.fillRect(0,
0,c,d);this.ctx.translate(this.padding,this.padding);this.ctx.scale(b,b);this.graphs[0].draw(this.ctx,b,a);this.ctx.restore()},drawPath:function(a,b,c,d){c&&(a.beginPath(),b.makePath(a),a.fill());if(a.fillStyle!=a.strokeStyle||!c){switch(d){case "dashed":a.beginPath();b.makeDashedPath(a,this.dashLength);break;case "dotted":var e=a.lineWidth;a.lineWidth*=2;a.beginPath();b.makeDottedPath(a,this.dotSpacing);break;default:c||(a.beginPath(),b.makePath(a))}a.stroke();if(e)a.lineWidth=e}},unescape:function(a){var b=
a.match(/^"(.*)"$/);return b?b[1].replace(/\\"/g,'"'):a},parseHexColor:function(a){if(a=a.match(/^#([0-9a-f]{2})\s*([0-9a-f]{2})\s*([0-9a-f]{2})\s*([0-9a-f]{2})?$/i)){var b,c="#"+a[1]+a[2]+a[3],d=1;a[4]?(d=parseInt(a[4],16)/255,b="rgba("+parseInt(a[1],16)+","+parseInt(a[2],16)+","+parseInt(a[3],16)+","+d+")"):b=c}return{canvasColor:b,textColor:c,opacity:d}},hsvToRgbColor:function(a,b,c){var d,e,g,h,f,i;a*=360;d=Math.floor(a/60)%6;e=a/60-d;a=c*(1-b);g=c*(1-e*b);b=c*(1-(1-e)*b);switch(d){case 0:h=c;
f=b;i=a;break;case 1:h=g;f=c;i=a;break;case 2:h=a;f=c;i=b;break;case 3:h=a;f=g;i=c;break;case 4:h=b;f=a;i=c;break;case 5:h=c,f=a,i=g}return"rgb("+Math.round(255*h)+","+Math.round(255*f)+","+Math.round(255*i)+")"},versionCompare:function(a,b){for(var a=a.split("."),b=b.split("."),c,d;a.length||b.length;){c=a.length?a.shift():0;d=b.length?b.shift():0;if(c<d)return-1;if(c>d)return 1}return 0},_handleMouseWheel:function(a){if(this.allowMouseScrolling){if(!a)a=window.event;var b=0;a.wheelDelta?(b=a.wheelDelta/
120,window.opera&&(b=-b)):a.detail&&(b=-a.detail/3);b&&this.setScale(this.getScale()+b/10);return DotUtils.preventDefault(a)}},idMatch:'([a-zA-Z\u0080-\uffff_][0-9a-zA-Z\u0080-\uffff_]*|-?(?:\\.\\d+|\\d+(?:\\.\\d*)?)|"(?:\\\\"|[^"])*"|<(?:<[^>]*>|[^<>]+?)+>)'});Dot.prototype.nodeIdMatch=Dot.prototype.idMatch+"(?::"+Dot.prototype.idMatch+")?(?::"+Dot.prototype.idMatch+")?";Dot.prototype.graphMatchRe=RegExp("^(strict\\s+)?(graph|digraph)(?:\\s+"+Dot.prototype.idMatch+")?\\s*{$","i");
Dot.prototype.subgraphMatchRe=RegExp("^(?:subgraph\\s+)?"+Dot.prototype.idMatch+"?\\s*{$","i");Dot.prototype.nodeMatchRe=RegExp("^("+Dot.prototype.nodeIdMatch+")\\s+\\[(.+)\\];$");Dot.prototype.edgeMatchRe=RegExp("^("+Dot.prototype.nodeIdMatch+"\\s*-[->]\\s*"+Dot.prototype.nodeIdMatch+")\\s+\\[(.+)\\];$");Dot.prototype.attrMatchRe=RegExp("^"+Dot.prototype.idMatch+"="+Dot.prototype.idMatch+"(?:[,\\s]+|$)");
var DotImage=DotUtils.createClass({initialize:function(a,b){this.dot=a;++this.dot.numImages;this.finished=this.loaded=false;this.img=new Image;this.img.onload=this.onLoad.bind(this);this.img.onerror=this.onFinish.bind(this);this.img.onabort=this.onFinish.bind(this);this.img.src=this.dot.imagePath+b},onLoad:function(){this.loaded=true;this.onFinish()},onFinish:function(){this.finished=true;++this.dot.numImagesFinished;this.dot.numImages==this.dot.numImagesFinished&&this.dot.draw(true)},draw:function(a,
b,c,d,e){this.finished&&(this.loaded?a.drawImage(this.img,b,c,d,e):(debug("can't load image "+this.img.src),this.drawBrokenImage(a,b,c,d,e)))},drawBrokenImage:function(a,b,c,d,e){a.save();a.beginPath();(new Rect(b,c,b+d,c+d)).draw(a);a.moveTo(b,c);a.lineTo(b+d,c+d);a.moveTo(b+d,c);a.lineTo(b,c+e);a.strokeStyle="#f00";a.lineWidth=1;a.stroke();a.restore()}});
function debug(a,b){a=String(a);typeof b==="undefined"&&(b=true);b&&(a=a.escapeHTML());document.getElementById("debug_output").innerHTML+="&raquo;"+a+"&laquo;<br />"}
var Point=DotUtils.createClass({initialize:function(a,b){this.x=a;this.y=b},offset:function(a,b){this.x+=a;this.y+=b},distanceFrom:function(a){var b=this.x-a.x,a=this.y-a.y;return Math.sqrt(b*b+a*a)},makePath:function(a){a.moveTo(this.x,this.y);a.lineTo(this.x+0.001,this.y)}}),Bezier=DotUtils.createClass({initialize:function(a){this.points=a;this.order=a.length},pathCommands:[null,function(a,b){this.lineTo(a+0.001,b)},function(a,b){this.lineTo(a,b)},function(a,b,c,d){this.quadraticCurveTo(a,b,c,d)},
function(a,b,c,d,e,g){this.bezierCurveTo(a,b,c,d,e,g)}],reset:function(){with(Bezier.prototype)this.controlPolygonLength=controlPolygonLength,this.chordLength=chordLength,this.triangle=triangle,this.chordPoints=chordPoints,this.coefficients=coefficients},offset:function(a,b){for(var c=0,d=this.points.length;c<d;++c)this.points[c].offset(a,b);this.reset()},getBB:function(){var f;if(this.order){var a,b,c,d;b=this.points[0];a=c=b.x;f=d=b.y,b=f;var e=0;for(a=this.points.length;e<a;++e){var g=this.points[e];
a=Math.min(a,g.x);b=Math.min(b,g.y);c=Math.max(c,g.x);d=Math.max(d,g.y)}var h=new Rect(a,b,c,d);return(this.getBB=function(){return h})()}},isPointInBB:function(a,b,c){typeof c==="undefined"&&(c=0);var d=this.getBB();0<c&&(d=DotUtils.extend({},d),d.inset(-c,-c));return!(a<d.l||a>d.r||b<d.t||b>d.b)},isPointOnBezier:function(a,b,c){typeof c==="undefined"&&(c=0);if(!this.isPointInBB(a,b,c))return false;for(var d=this.chordPoints(),e=d[0].p,g,h,f,i,l,k,m=1;m<d.length;++m){g=d[m].p;h=e.x;f=e.y;i=g.x;l=
g.y;k=new Rect(h,f,i,l);if(k.isPointInBB(a,b,c)&&(h=Math.abs(h*l+i*b+a*f-i*f-a*l-h*b),e=e.distanceFrom(g),e=h/e,e<=c))return true;e=g}return false},controlPolygonLength:function(){for(var a=0,b=1;b<this.order;++b)a+=this.points[b-1].distanceFrom(this.points[b]);return(this.controlPolygonLength=function(){return a})()},chordLength:function(){var a=this.points[0].distanceFrom(this.points[this.order-1]);return(this.chordLength=function(){return a})()},triangle:function(){for(var a=this.points,b=[a],
c=1;c<this.order;++c){for(var d=[],e=0;e<this.order-c;++e){var g=a[e],h=a[e+1];d[e]=new Point((g.x+h.x)/2,(g.y+h.y)/2)}b.push(d);a=d}return(this.triangle=function(){return b})()},triangleAtT:function(a){for(var b=1-a,c=this.points,d=[c],e=1;e<this.order;++e){for(var g=[],h=0;h<this.order-e;++h){var f=c[h],i=c[h+1];g[h]=new Point(f.x*b+i.x*a,f.y*b+i.y*a)}d.push(g);c=g}return d},split:function(a){"undefined"==typeof a&&(a=0.5);for(var a=0.5==a?this.triangle():this.triangleAtT(a),b=Array(this.order),
c=Array(this.order),d=0;d<this.order;++d)b[d]=a[d][0],c[d]=a[this.order-1-d][d];return{left:new Bezier(b),right:new Bezier(c)}},mid:function(a,b){return this.split(b).left.split(a/b).right},chordPoints:function(){var a=[{tStart:0,tEnd:0,dt:0,p:this.points[0]}].concat(this._chordPoints(0,1));return(this.chordPoints=function(){return a})()},_chordPoints:function(a,b){var c=b-a;if(this.controlPolygonLength()<=1.001*this.chordLength())return[{tStart:a,tEnd:b,dt:c,p:this.points[this.order-1]}];else{var c=
a+c/2,d=this.split();return d.left._chordPoints(a,c).concat(d.right._chordPoints(c,b))}},markedEvery:function(a,b){for(var c=b||a,d=this.chordPoints(),e=[],g=0,h,f,i=1;i<d.length;++i)if(f=d[i],f.length=f.p.distanceFrom(d[i-1].p),0==f.length)g+=f.dt;else{h=c/f.length*f.dt;for(f.remainingLength=f.length;f.remainingLength>=c;)f.remainingLength-=c,g+=h,e.push(g),a!=c&&(c=a,h=c/f.length*f.dt);c-=f.remainingLength;g=f.tEnd}return{times:e,nextDistance:c}},coefficients:function(){function a(a){for(;a.length>
1;){for(var b=Array(a.length-1),c=0;c<a.length-1;++c){var d=b,e=c,g=a[c],j=a[c+1];g.push(0);var o=Array(g.length);o[0]=g[0];for(var q=0;q<j.length;++q)o[q+1]=g[q+1]+j[q]-g[q];d[e]=o}a=b}return a[0]}for(var b=[],c=[],d=0,e;e=this.points[d++];)b.push([e.x]),c.push([e.y]);var g={xs:a(b),ys:a(c)};return(this.coefficients=function(){return g})()},pointAtT:function(a){for(var b=this.coefficients(),c=b.xs,b=b.ys,d=c[c.length-1],e=b[b.length-1],g=c.length-1;--g>=0;)d=d*a+c[g],e=e*a+b[g];return new Point(d,
e)},makePath:function(a,b){"undefined"==typeof b&&(b=true);b&&a.moveTo(this.points[0].x,this.points[0].y);var c=this.pathCommands[this.order];if(c){for(var d=[],e=1==this.order?0:1;e<this.points.length;++e)d.push(this.points[e].x),d.push(this.points[e].y);c.apply(a,d)}},makeDashedPath:function(a,b,c,d){c||(c=b);"undefined"==typeof d&&(d=true);b=this.markedEvery(b,c);d&&b.times.unshift(0);(d=b.times.length%2)&&b.times.push(1);for(c=1;c<b.times.length;c+=2)this.mid(b.times[c-1],b.times[c]).makePath(a);
return{firstDistance:b.nextDistance,drawFirst:d}},makeDottedPath:function(a,b,c){c||(c=b);var d=this.markedEvery(b,c);b==c&&d.times.unshift(0);b=0;for(c=d.times.length;b<c;++b)this.pointAtT(d.times[b]).makePath(a);return d.nextDistance}}),Path=DotUtils.createClass({initialize:function(a){this.segments=a||[]},setupSegments:function(){},addBezier:function(a){this.segments.push(a instanceof Array?new Bezier(a):a)},offset:function(a,b){0==this.segments.length&&this.setupSegments();for(var c=0,d=this.segments.length;c<
d;++c)this.segments[c].offset(a,b)},getBB:function(){var j;0==this.segments.length&&this.setupSegments();var a,b,c,d;b=this.segments[0].points[0];a=c=b.x;j=d=b.y,b=j;for(var e=0,g=this.segments.length;e<g;++e)for(var h=this.segments[e].points,f=0,i=h.length;f<i;++f){var l=h[f];a=Math.min(a,l.x);b=Math.min(b,l.y);c=Math.max(c,l.x);d=Math.max(d,l.y)}var k=new Rect(a,b,c,d);return(this.getBB=function(){return k})()},isPointInBB:function(a,b,c){typeof c==="undefined"&&(c=0);var d=this.getBB();0<c&&(d=
DotUtils.extend({},d),d.inset(-c,-c));return!(a<d.l||a>d.r||b<d.t||b>d.b)},isPointOnPath:function(a,b,c){typeof c==="undefined"&&(c=0);if(!this.isPointInBB(a,b,c))return false;for(var d=0,e=this.segments.length;d<e;++d)if(this.segments[d].isPointOnBezier(a,b,c))throw $break;return false},isPointInPath:function(){return false},makePath:function(a){0==this.segments.length&&this.setupSegments();for(var b=true,c=0,d=this.segments.length;c<d;++c)this.segments[c].makePath(a,b),b=false},makeDashedPath:function(a,
b,c,d){0==this.segments.length&&this.setupSegments();for(var c={drawFirst:"undefined"==typeof d?true:d,firstDistance:c||b},d=0,e=this.segments.length;d<e;++d)c=this.segments[d].makeDashedPath(a,b,c.firstDistance,c.drawFirst)},makeDottedPath:function(a,b,c){0==this.segments.length&&this.setupSegments();c||(c=b);for(var d=0,e=this.segments.length;d<e;++d)c=this.segments[d].makeDottedPath(a,b,c)}}),Polygon=DotUtils.createClass(Path,{initialize:function($super,b){this.points=b||[];$super()},setupSegments:function(){for(var a=
0,b=this.points.length;a<b;++a){var c=a+1;b==c&&(c=0);this.addBezier([this.points[a],this.points[c]])}}}),Rect=DotUtils.createClass(Polygon,{initialize:function($super,b,c,d,e){this.l=b;this.t=c;this.r=d;this.b=e;$super()},inset:function(a,b){this.l+=a;this.t+=b;this.r-=a;this.b-=b;return this},expandToInclude:function(a){this.l=Math.min(this.l,a.l);this.t=Math.min(this.t,a.t);this.r=Math.max(this.r,a.r);this.b=Math.max(this.b,a.b)},getWidth:function(){return this.r-this.l},getHeight:function(){return this.b-
this.t},setupSegments:function($super){var b=this.getWidth(),c=this.getHeight();this.points=[new Point(this.l,this.t),new Point(this.l+b,this.t),new Point(this.l+b,this.t+c),new Point(this.l,this.t+c)];$super()}}),Ellipse=DotUtils.createClass(Path,{KAPPA:0.5522847498,initialize:function($super,b,c,d,e){this.cx=b;this.cy=c;this.rx=d;this.ry=e;$super()},setupSegments:function(){this.addBezier([new Point(this.cx,this.cy-this.ry),new Point(this.cx+this.KAPPA*this.rx,this.cy-this.ry),new Point(this.cx+
this.rx,this.cy-this.KAPPA*this.ry),new Point(this.cx+this.rx,this.cy)]);this.addBezier([new Point(this.cx+this.rx,this.cy),new Point(this.cx+this.rx,this.cy+this.KAPPA*this.ry),new Point(this.cx+this.KAPPA*this.rx,this.cy+this.ry),new Point(this.cx,this.cy+this.ry)]);this.addBezier([new Point(this.cx,this.cy+this.ry),new Point(this.cx-this.KAPPA*this.rx,this.cy+this.ry),new Point(this.cx-this.rx,this.cy+this.KAPPA*this.ry),new Point(this.cx-this.rx,this.cy)]);this.addBezier([new Point(this.cx-this.rx,
this.cy),new Point(this.cx-this.rx,this.cy-this.KAPPA*this.ry),new Point(this.cx-this.KAPPA*this.rx,this.cy-this.ry),new Point(this.cx,this.cy-this.ry)])}});
